"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.orderLayout = void 0;
const physics_1 = require("../../physics");
const DAMPING = 0.5;
const VERTICAL_PUSH_FORCE = 1000;
const HORIZONTAL_PUSH_FORCE = 1000;
const IDEAL_MIN_VERTICAL_DIS = 150;
const IDEAL_MAX_VERTICAL_DIS = 200;
const MIN_HORIZONTAL_DISTANCE = 400;
const MIN_VERTCIAL_DISTANCE_TO_APPLY_HOR_DISTANCE = 80; // only if they are at least 100 pixels close we want to move them apart
const MIN_VERTICAL_DISTANCE_FOR_ALIGNING = 50;
const ALIGNMENT_FORCE = 100;
const MIN_ENERGY = 0.01;
const MAX_SPEED = 100;
const DT_SIZE = 15;
const MIN_DIS_FROM_NODE_I_TO_O = 500;
const entitiesToLayout = (entities) => {
    return entities.reduce((prev, curr) => {
        const topLeft = (0, physics_1.vSub)(curr.p, (0, physics_1.vec)(curr.s.width / 2, curr.s.height / 2));
        return { ...prev, [curr.id]: { p: topLeft, s: curr.s } };
    }, {});
};
const orderLayout = ({ nodes, edges }, maxItrs, onItr) => {
    let entities = Object.entries(nodes).map(([id, value]) => {
        const center = (0, physics_1.vAdd)(value.p, (0, physics_1.vec)(value.s.width / 2, value.s.height / 2));
        return {
            id,
            p: center,
            f: (0, physics_1.vec)(0, 0),
            v: (0, physics_1.vec)(0, 0),
            m: 1,
            s: value.s,
        };
    });
    let itrs = 0;
    while (itrs < maxItrs && (itrs < 2 || (0, physics_1.totalEnergy)(entities) > MIN_ENERGY)) {
        // eslint-disable-next-line no-loop-func
        let ents = entities;
        for (let i = 0; i < ents.length; i++) {
            for (let j = i + 1; j < ents.length; j++) {
                if (i !== j) {
                    const e1 = ents[i];
                    const e2 = ents[j];
                    if (!e1 || !e2) {
                        continue;
                    }
                    const diff = (0, physics_1.vSub)(e1.p, e2.p);
                    const dx = Math.abs(diff.x);
                    const dy = Math.abs(diff.y);
                    const isE1NodeInput = e1.id.startsWith("node-input");
                    const isE1NodeOutput = e1.id.startsWith("node-output");
                    const isE2NodeInput = e2.id.startsWith("node-input");
                    const isE2NodeOutput = e2.id.startsWith("node-output");
                    // push aside those that are too close horizontally
                    if (dx < MIN_HORIZONTAL_DISTANCE &&
                        dy < MIN_VERTCIAL_DISTANCE_TO_APPLY_HOR_DISTANCE) {
                        const delta = MIN_HORIZONTAL_DISTANCE - dx;
                        const force = delta * HORIZONTAL_PUSH_FORCE;
                        e1.f = (0, physics_1.vAdd)(e1.f, (0, physics_1.vec)(force * 0.5, 0));
                        e2.f = (0, physics_1.vAdd)(e2.f, (0, physics_1.vec)(force * -0.5, 0));
                    }
                    if (dy < MIN_VERTICAL_DISTANCE_FOR_ALIGNING) {
                        const force = diff.y * ALIGNMENT_FORCE;
                        e1.f = (0, physics_1.vAdd)(e1.f, (0, physics_1.vec)(0, force * 0.5));
                        e2.f = (0, physics_1.vAdd)(e2.f, (0, physics_1.vec)(0, force * -0.5));
                    }
                    if (isE1NodeInput && isE2NodeOutput) {
                        // make sure e1 is above e2
                        const delta = (0, physics_1.vSub)(e1.p, e2.p);
                        const dy = delta.y;
                        if (dy < -MIN_DIS_FROM_NODE_I_TO_O) {
                            const mod = MIN_HORIZONTAL_DISTANCE - dy;
                            const force = mod * ALIGNMENT_FORCE;
                            e1.f = (0, physics_1.vAdd)(e1.f, (0, physics_1.vec)(0, force * -0.5));
                            e2.f = (0, physics_1.vAdd)(e2.f, (0, physics_1.vec)(0, force * 0.5));
                        }
                    }
                    else if (isE1NodeOutput && isE2NodeInput) {
                        const delta = (0, physics_1.vSub)(e1.p, e2.p);
                        const dy = delta.y;
                        if (dy < MIN_DIS_FROM_NODE_I_TO_O) {
                            const mod = MIN_HORIZONTAL_DISTANCE - dy;
                            const force = mod * ALIGNMENT_FORCE;
                            e1.f = (0, physics_1.vAdd)(e1.f, (0, physics_1.vec)(0, force * -0.5));
                            e2.f = (0, physics_1.vAdd)(e2.f, (0, physics_1.vec)(0, force * 0.5));
                        }
                    }
                    else if (isE1NodeInput && isE2NodeInput) {
                        // make sure e1 and e2 are aligned horizontal
                    }
                    else if (isE2NodeInput && isE2NodeOutput) {
                        // make sure e1 and e2 are aligned horizontal
                    }
                    // push to middle
                    const midDif = (0, physics_1.vSub)(e1.p, (0, physics_1.vec)(0, e1.p.y));
                    // const midDif2 = vSub(e2.p, vec(0, e.p.y ));
                    const distanceFromMiddle = (0, physics_1.vLen)(midDif);
                    const force = (0, physics_1.vMul)((0, physics_1.vNorm)(midDif), distanceFromMiddle * -50);
                    e1.f = (0, physics_1.vAdd)(e1.f, force);
                }
            }
        }
        edges.forEach((edge) => {
            let e1 = ents.find((e) => e.id === edge[0]);
            let e2 = ents.find((e) => e.id === edge[1]);
            if (!e1 || !e2) {
                console.warn("weoops", edge[0], edge[1]);
                return;
            }
            const idealDiff = (0, physics_1.vec)(0, -IDEAL_MAX_VERTICAL_DIS);
            const realDiff = (0, physics_1.vSub)(e1.p, e2.p);
            const delta = (0, physics_1.vSub)(idealDiff, realDiff);
            const deltaLen = (0, physics_1.vLen)(delta);
            const forceMagnitude = deltaLen * VERTICAL_PUSH_FORCE;
            // only apply if it's a distancing force, not pushing
            // if (forceMagnitude > 0) {
            const force1 = (0, physics_1.vMul)((0, physics_1.vNorm)(delta), forceMagnitude * 0.5);
            const force2 = (0, physics_1.vMul)((0, physics_1.vNorm)(delta), forceMagnitude * -0.5);
            e1.f = (0, physics_1.vAdd)(e1.f, force1);
            e2.f = (0, physics_1.vAdd)(e2.f, force2);
        });
        // make the wheels of neuton turn
        ents = ents.map((ent) => {
            return (0, physics_1.itrPhysics)(DT_SIZE, ent);
        });
        // damp & cap speed
        ents = ents.map((ent) => {
            const damped = (0, physics_1.vMul)(ent.v, DAMPING);
            const vel = (0, physics_1.vLen)(damped) > MAX_SPEED ? (0, physics_1.vMul)((0, physics_1.vNorm)(damped), MAX_SPEED) : damped;
            return { ...ent, v: vel };
        });
        entities = ents;
        if (onItr) {
            onItr({
                nodes: entitiesToLayout(ents),
                edges,
            }, itrs);
        }
        itrs++;
    }
    return {
        nodes: entitiesToLayout(entities),
        edges,
        itrs,
        timeout: itrs >= maxItrs,
        total: (0, physics_1.totalEnergy)(entities),
    };
};
exports.orderLayout = orderLayout;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvdmlzdWFsLW5vZGUtZWRpdG9yL29yZGVyLWxheW91dC9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSwyQ0FXdUI7QUFVdkIsTUFBTSxPQUFPLEdBQUcsR0FBRyxDQUFDO0FBQ3BCLE1BQU0sbUJBQW1CLEdBQUcsSUFBSSxDQUFDO0FBQ2pDLE1BQU0scUJBQXFCLEdBQUcsSUFBSSxDQUFDO0FBRW5DLE1BQU0sc0JBQXNCLEdBQUcsR0FBRyxDQUFDO0FBQ25DLE1BQU0sc0JBQXNCLEdBQUcsR0FBRyxDQUFDO0FBRW5DLE1BQU0sdUJBQXVCLEdBQUcsR0FBRyxDQUFDO0FBQ3BDLE1BQU0sMkNBQTJDLEdBQUcsRUFBRSxDQUFDLENBQUMsd0VBQXdFO0FBRWhJLE1BQU0sa0NBQWtDLEdBQUcsRUFBRSxDQUFDO0FBQzlDLE1BQU0sZUFBZSxHQUFHLEdBQUcsQ0FBQztBQUU1QixNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUM7QUFDeEIsTUFBTSxTQUFTLEdBQUcsR0FBRyxDQUFDO0FBQ3RCLE1BQU0sT0FBTyxHQUFHLEVBQUUsQ0FBQztBQUVuQixNQUFNLHdCQUF3QixHQUFHLEdBQUcsQ0FBQztBQUVyQyxNQUFNLGdCQUFnQixHQUFHLENBQUMsUUFBa0IsRUFBa0IsRUFBRTtJQUM5RCxPQUFPLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLEVBQUU7UUFDcEMsTUFBTSxPQUFPLEdBQUcsSUFBQSxjQUFJLEVBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxJQUFBLGFBQUcsRUFBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN2RSxPQUFPLEVBQUUsR0FBRyxJQUFJLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFB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